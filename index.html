<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
  <title>FreeLoop Player</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="Logo.png" type="image/png">
</head>

<body>
  <div class="main-container">
    <div class="player-container">
      <nav class="head_container">
        <h3 class="header">FreeLoop</h3>
        <h4 class="Welcome">Hiphop Tamizha Playlist</h4>
      </nav>
      <div class="spotify-app">
        <div class="container">
          <div class="search-bar">
            <input id="search" type="text" placeholder="Search for a song...">
          </div>
          <ul id="trackList" class="track-list">
            <!-- Tracks will be dynamically added here -->
          </ul>
          <!-- Player control -->
          <div class="player-container modified-player">
            <div class="player">
              <div id="cover-container">
                <img id="cover" src="/api/placeholder/50/50" alt="Album Cover">
              </div>
              <h3 id="title">Select a Song</h3>
              <p id="artist">Artist</p>
              <div class="progress-bar">
                <span id="currentTime">0:00</span>
                <input id="progress" type="range" min="0" max="100" value="0">
                <span id="duration">0:00</span>
              </div>
              <div class="player-controls">
                <button id="prev" aria-label="Previous Song">⏮</button>
                <button id="playPause" aria-label="Play/Pause">▶️</button>
                <button id="next" aria-label="Next Song">⏭</button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="bottom-menu">
        <a href="https://mohanraj2622.github.io/FreeLoop/" class="menu-item">
          <i class="fas fa-home"></i>
          <span>Home</span>
        </a>
        <a href="#search" class="menu-item">
          <i class="fas fa-search"></i>
          <span>Search</span>
        </a>
        <a href="feedback.html" class="menu-item album-btn">
          <i class="fas fa-comment-alt"></i>
          <span>Feedback</span>
        </a>
      </div>
      <div id="offlineMessage" style="display: none; background: red; color: white; padding: 10px; text-align: center;">
        No Internet Connection! Please reconnect.
      </div>

      <script>
        function updateOnlineStatus() {
          let offlineMessage = document.getElementById("offlineMessage");
          if (!navigator.onLine) {
            offlineMessage.style.display = "block";
          } else {
            offlineMessage.style.display = "none";
          }
        }

        // Run on load and listen for changes
        window.addEventListener("load", updateOnlineStatus);
        window.addEventListener("offline", updateOnlineStatus);
        window.addEventListener("online", updateOnlineStatus);
      </script>
      <!-- jsmediatags Library -->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jsmediatags/3.9.5/jsmediatags.min.js"></script>
      <script src="script.js"></script>

      <script>
        document.addEventListener("DOMContentLoaded", function () {
          const player = document.querySelector(".modified-player");
          let fullscreenActive = false;

          let audio = document.getElementById("audio");
          if (!audio) {
            audio = document.createElement('audio');
            audio.id = 'audio';
            document.body.appendChild(audio);
          }

          // Main player controls
          const playPauseBtn = document.getElementById("playPause");
          const prevBtn = document.getElementById("prev");
          const nextBtn = document.getElementById("next");
          const progressBar = document.getElementById("progress");
          const currentTimeDisplay = document.getElementById("currentTime");
          const durationDisplay = document.getElementById("duration");

          // Play/Pause functionality
          playPauseBtn.addEventListener("click", function () {
            togglePlayPause();
          });

          // Previous song functionality
          prevBtn.addEventListener("click", function () {
            playPreviousSong();
          });

          // Next song functionality
          nextBtn.addEventListener("click", function () {
            playNextSong();
          });

          // Progress bar functionality
          progressBar.addEventListener("input", function () {
            if (audio.duration && isFinite(audio.duration)) {
              const seekTime = (this.value / 100) * audio.duration;
              audio.currentTime = seekTime;
            }
          });

          // Update progress bar and time displays
          audio.addEventListener("timeupdate", function () {
            updateProgress();
          });

          // Open fullscreen player
          player.addEventListener("click", function () {
            if (!fullscreenActive) {
              fullscreenActive = true;
              openFullscreenPlayer();
            }
          });

          function openFullscreenPlayer() {
            fullscreenActive = true;

            let fullscreenOverlay = document.createElement("div");
            fullscreenOverlay.classList.add("fullscreen-player");
            fullscreenOverlay.innerHTML = `
              <div class="controls">
                <button class="close-btn" id="closeFullscreen">×</button>
              </div>
              <div class="song-info">
                <div id="cover-container">
                  <img id="fullscreen-cover" src="${document.getElementById("cover").src}" alt="Album Cover">
                </div>
                <h3 id="fullscreen-title">${document.getElementById("title").innerText}</h3>
                <p id="fullscreen-artist">${document.getElementById("artist").innerText}</p>
              </div>
              <div class="progress-bar">
                <span id="fullscreen-currentTime">${document.getElementById("currentTime").innerText}</span>
                <input id="fullscreen-progress" type="range" min="0" max="100" value="${document.getElementById("progress").value}">
                <span id="fullscreen-duration">${document.getElementById("duration").innerText}</span>
              </div>
              <div class="p-controls">
                <button id="fullscreen-prev">⏮</button>
                <button id="fullscreen-playPause">${audio.paused ? '▶️' : '⏸'}</button>
                <button id="fullscreen-next">⏭</button>
              </div>
            `;

            document.body.appendChild(fullscreenOverlay);

            // Close fullscreen event
            document.getElementById("closeFullscreen").addEventListener("click", function () {
              closeFullscreenPlayer(fullscreenOverlay);
            });

            // Sync play/pause button in fullscreen
            document.getElementById("fullscreen-playPause").addEventListener("click", function () {
              togglePlayPause();
            });

            // Sync previous button in fullscreen
            document.getElementById("fullscreen-prev").addEventListener("click", function () {
              playPreviousSong();
            });

            // Sync next button in fullscreen
            document.getElementById("fullscreen-next").addEventListener("click", function () {
              playNextSong();
            });

            // Sync progress bar in fullscreen
            document.getElementById("fullscreen-progress").addEventListener("input", function () {
              if (audio.duration && isFinite(audio.duration)) {
                const seekTime = (this.value / 100) * audio.duration;
                audio.currentTime = seekTime;
              }
            });
          }

          function closeFullscreenPlayer(overlay) {
            fullscreenActive = false;
            overlay.remove();
          }

          function togglePlayPause() {
            if (audio.paused) {
              audio.play().catch(error => console.warn("Autoplay blocked:", error));
              playPauseBtn.innerText = '⏸';
              if (document.getElementById("fullscreen-playPause")) {
                document.getElementById("fullscreen-playPause").innerText = '⏸';
              }
            } else {
              audio.pause();
              playPauseBtn.innerText = '▶️';
              if (document.getElementById("fullscreen-playPause")) {
                document.getElementById("fullscreen-playPause").innerText = '▶️';
              }
            }
          }

          function playPreviousSong() {
            console.log("Playing previous song");
            // Add logic to play the previous song
          }

          function playNextSong() {
            
            // Add logic to play the next song
          }

          function updateProgress() {
            if (!audio.duration || !isFinite(audio.duration)) return;

            const currentTime = audio.currentTime;
            const duration = audio.duration;
            const progressPercent = (currentTime / duration) * 100;

            // Update progress bar and time displays
            progressBar.value = progressPercent;
            currentTimeDisplay.textContent = formatTime(currentTime);
            durationDisplay.textContent = formatTime(duration);

            // Update fullscreen player if it exists
            if (document.getElementById("fullscreen-progress")) {
              document.getElementById("fullscreen-progress").value = progressPercent;
              document.getElementById("fullscreen-currentTime").textContent = formatTime(currentTime);
              document.getElementById("fullscreen-duration").textContent = formatTime(duration);
            }
          }

          // Format time properly (MM:SS)
          function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.floor(seconds % 60);
            return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
          }
        });
      </script>
    </div>
  </div>
</body>

</html>
